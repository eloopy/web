<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Eloopy HomeCam - Login</title>
  <script>
    function handleLogin(event) {
      event.preventDefault();
      const password = document.getElementById('password').value.trim();
      if (!password) return;

      const scriptURL = 'https://script.google.com/macros/s/AKfycbwUL2GkSwAGMo7H8MJD1rDY-zXEjUr1jg8WEr0zB4EEX2QrQI6XDWQHofbgk5seVl_O5w/exec?password=' + encodeURIComponent(password);

      fetch(scriptURL)
        .then(response => response.text())
        .then(result => {
          const trimmed = result.trim();
          if (trimmed === "0") {
            document.getElementById('message').innerText = "Invalid password. Please try again.";
          } else {
            const targetURL = `http://${trimmed}:7117`;
            console.log("Redirecting to:", targetURL);
            window.location.href = targetURL;
          }
        })
        .catch(error => {
          console.error("Failed to fetch IP:", error);
          document.getElementById('message').innerText = "Failed to connect to script.";
        });
    }
  </script>
</head>
<body>
  <center>
    <h1>Eloopy HomeCam Login</h1>
    <form onsubmit="handleLogin(event)">
      <input type="password" id="password" placeholder="Enter password" required>
      <button type="submit">Login</button>
    </form>
    <p id="message" style="color: red;"></p>
  </center>
</body>
</html>
